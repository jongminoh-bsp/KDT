name: 🤖 Amazon Q Test

on:
  push:
    branches: [dev]
    paths: ['test_app/**']

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install boto3
      run: pip install boto3>=1.34.0
    
    - name: Test Amazon Bedrock
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      run: |
        python3 << 'EOF'
        import boto3
        import json
        
        try:
            print("🤖 Testing Amazon Bedrock (Seoul)...")
            
            client = boto3.client('bedrock-runtime', region_name='ap-northeast-2')
            
            response = client.invoke_model(
                modelId='anthropic.claude-3-haiku-20240307-v1:0',
                body=json.dumps({
                    "anthropic_version": "bedrock-2023-05-31",
                    "max_tokens": 200,
                    "messages": [{
                        "role": "user", 
                        "content": "Hello! Can you analyze a Node.js Express app? Just say 'Yes, I can help with Node.js analysis' if working."
                    }]
                })
            )
            
            result = json.loads(response['body'].read())
            ai_response = result['content'][0]['text']
            
            print("🎉 SUCCESS! Amazon Bedrock Claude Response:")
            print("=" * 50)
            print(ai_response)
            print("=" * 50)
            print("✅ Amazon Q AI is working!")
            
        except Exception as e:
            print(f"❌ Error: {e}")
            exit(1)
        EOF
